name: CI - Test Python

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: R√©cup√©ration du d√©p√¥t
        uses: actions/checkout@v3

      - name: Installation de Python
        uses: actions/setup-python@v3
        with:
          python-version: '3.10'

      - name: Installer les d√©pendances
        run: pip install pytest

      - name: Ex√©cuter les tests
        run: pytest --maxfail=1 --disable-warnings -v

      - name: V√©rifier la pr√©sence des tests
        run: ls -R
      
      - name: Ex√©cuter les tests
        run: python -m pytest

  cd:
    name: üöÄ Continuous Deployment (D√©ploiement)
    needs: test
    runs-on: ubuntu-latest
    if: success() 

    steps:
      - name: üì• Cloner le d√©p√¥t
        uses: actions/checkout@v3

      - name: üöÄ D√©ployer sur Railway
        run: |
          curl -X POST "https://backboard.railway.app/graphql/v2" \
          -H "Authorization: Bearer $7171fad1-8135-4830-b270-e706739d61fe" \
          -H "Content-Type: application/json" \
          --data '{ "query": "mutation { deploymentCreate(input: { projectId: \"honest-playfulness\" }) { id } }" }'